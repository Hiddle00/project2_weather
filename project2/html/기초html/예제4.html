<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë‚ ì”¨ ê¸°ë°˜ ìŒì‹ ì¶”ì²œ & ì§€ë„</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
    body { font-family: Arial; margin:0; padding:20px; }
    .container { max-width: 800px; margin:auto; }
    input, button { padding:10px; margin-top:10px; width:100%; }
    #map { height: 400px; width:100%; margin-top:20px; }
    .card { padding:15px; border:1px solid #ddd; border-radius:8px; margin-top:20px; }
</style>
</head>

<body>
<div class="container">
    <h2>ğŸ½ ë‚ ì”¨ ê¸°ë°˜ ìŒì‹ ì¶”ì²œ + ì£¼ë³€ ì‹ë‹¹ ì§€ë„</h2>

    <input id="locationInput" placeholder="ì˜ˆ: ì„œìš¸, ë¶€ì‚°, Tokyo">
    <button onclick="loadAll()">ì¡°íšŒí•˜ê¸°</button>

    <div id="weatherBox" class="card" style="display:none;">
        <h3>ğŸŒ¤ ë‚ ì”¨ ì •ë³´</h3>
        ê¸°ì˜¨: <span id="temp"></span>Â°C<br>
        êµ¬ë¦„: <span id="cloud"></span>% <br>
        ê°•ìˆ˜ëŸ‰: <span id="rain"></span> mm <br>
        ìŠµë„: <span id="humidity"></span>% 
    </div>

    <div id="foodBox" class="card" style="display:none;">
        <h3>ğŸœ ì¶”ì²œ ìŒì‹</h3>
        <p id="recommendedFood"></p>
    </div>

    <div id="mapBox" style="display:none;">
        <h3>ğŸ“ ì£¼ë³€ ìŒì‹ì  ì§€ë„</h3>
        <div id="map"></div>
    </div>
</div>

<script>
let map;

// 1) ìœ„ì¹˜ â†’ ì¢Œí‘œ ë³€í™˜
async function geocode(loc) {
    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${loc}`;
    const res = await fetch(url);
    const data = await res.json();
    if (!data.length) throw "ì¢Œí‘œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
    return [data[0].lat, data[0].lon];
}

// 2) ë‚ ì”¨ ì¡°íšŒ (OpenWeather API ìë¦¬)
async function loadWeather(lat, lon) {
    // ì‹¤ì œë¡œëŠ” API í‚¤ í•„ìš” â€“ ë°ëª¨ ë°ì´í„° ì‚¬ìš©
    return {
        temp: 13,
        cloud: 70,
        rain: 0,
        humidity: 55
    };
}

// 3) ì¶”ì²œ ìŒì‹ ë¡œì§
function recommendFood(w) {
    if (w.temp < 10) return "ë”°ëœ»í•œ êµ­ë¬¼ ìš”ë¦¬: ë¼ë©˜, ì „ê³¨, ì„¤ë íƒ•";
    if (w.rain > 1) return "ë¹„ ì˜¤ëŠ” ë‚  íŒŒì „ + ë§‰ê±¸ë¦¬!";
    if (w.cloud > 60) return "ë“ ë“ í•œ ìŒì‹: ì¹´ë ˆë¼ì´ìŠ¤, ì°œë‹­";
    return "ê°€ë²¼ìš´ ìŒì‹: ì´ˆë°¥, ìƒëŸ¬ë“œ";
}

// 4) ì£¼ë³€ ìŒì‹ì  ê²€ìƒ‰
async function loadRestaurants(lat, lon) {
    const query = `
        [out:json];
        node["amenity"="restaurant"](around:1500, ${lat}, ${lon});
        out;`;
    const res = await fetch("https://overpass-api.de/api/interpreter", { method:"POST", body:query });
    const data = await res.json();
    return data.elements;
}

// 5) ì§€ë„ ìƒì„± + ìŒì‹ì  í‘œì‹œ
function renderMap(lat, lon, restaurants) {
    if (!map) {
        map = L.map('map').setView([lat, lon], 14);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    } else {
        map.setView([lat, lon], 14);
    }

    L.marker([lat, lon]).addTo(map).bindPopup("ê¸°ì¤€ ìœ„ì¹˜");

    restaurants.forEach(r => {
        L.marker([r.lat, r.lon]).addTo(map)
            .bindPopup(r.tags.name || "ì´ë¦„ ì—†ìŒ");
    });
}

// ì „ì²´ ë¡œë”© ì‹œì‘
async function loadAll() {
    try {
        const loc = document.getElementById("locationInput").value;
        if (!loc) return alert("ì§€ì—­ì„ ì…ë ¥í•˜ì„¸ìš”.");

        const [lat, lon] = await geocode(loc);
        const weather = await loadWeather(lat, lon);

        document.getElementById("temp").textContent = weather.temp;
        document.getElementById("cloud").textContent = weather.cloud;
        document.getElementById("rain").textContent = weather.rain;
        document.getElementById("humidity").textContent = weather.humidity;
        document.getElementById("weatherBox").style.display = "block";

        const recommended = recommendFood(weather);
        document.getElementById("recommendedFood").textContent = recommended;
        document.getElementById("foodBox").style.display = "block";

        const restaurants = await loadRestaurants(lat, lon);
        renderMap(lat, lon, restaurants);

        document.getElementById("mapBox").style.display = "block";

    } catch(e) {
        alert("ì—ëŸ¬: " + e);
    }
}
</script>
</body>
</html>