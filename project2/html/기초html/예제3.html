<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê·¼ì²˜ ìŒì‹ì  ì§€ë„</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        body { font-family: Arial; margin: 0; padding: 0; }
        #map { height: 100vh; width: 100%; }
        .info { position: absolute; top: 10px; left: 10px; background: white; padding: 10px; z-index: 1000; border-radius: 6px; }
    </style>
</head>
<body>

<div class="info">
    <b>ğŸ“ ì£¼ë³€ ìŒì‹ì  ë³´ê¸°</b><br>
    ì§€ì—­: <span id="loc"></span>
</div>
<div id="map"></div>

<script>
const params = new URLSearchParams(location.search);
const loc = params.get("loc");
document.getElementById("loc").textContent = loc;

// 1) ì§€ì—­ ì´ë¦„ â†’ ì¢Œí‘œ ë³€í™˜ (Nominatim API ì‚¬ìš©: ë¬´ë£Œ)
async function geocode(location) {
    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${location}`;
    const res = await fetch(url);
    const data = await res.json();
    return [data[0].lat, data[0].lon];
}

// 2) ê·¼ì²˜ ìŒì‹ì  ê²€ìƒ‰ (Overpass API)
async function loadNearbyRestaurants(lat, lon) {
    const query = `
        [out:json];
        node
          ["amenity"="restaurant"]
          (around:1500, ${lat}, ${lon});
        out;
    `;
    const url = "https://overpass-api.de/api/interpreter";

    const res = await fetch(url, {
        method: "POST",
        body: query
    });
    const data = await res.json();
    return data.elements;
}

(async function init() {
    const [lat, lon] = await geocode(loc);

    // ì§€ë„ ìƒì„±
    const map = L.map('map').setView([lat, lon], 14);
    L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

    // ì§€ì—­ ì¤‘ì‹¬ ë§ˆì»¤
    L.marker([lat, lon]).addTo(map).bindPopup("ğŸ“ ì¤‘ì‹¬ ìœ„ì¹˜");

    // ìŒì‹ì  ê°€ì ¸ì˜¤ê¸°
    const restaurants = await loadNearbyRestaurants(lat, lon);

    restaurants.forEach(r => {
        L.marker([r.lat, r.lon]).addTo(map)
            .bindPopup(`ğŸ½ ${r.tags.name || "ì´ë¦„ ì—†ìŒ"}`);
    });
})();
</script>

</body>
</html>
